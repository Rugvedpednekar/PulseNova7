<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulseNova - AI Medical Assistant</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Voice overlay */
        @keyframes pulseWave {
            0% { transform: scaleY(0.25); opacity: 0.5; }
            50% { transform: scaleY(1); opacity: 1; }
            100% { transform: scaleY(0.35); opacity: 0.7; }
        }
        .voice-wave-bar {
            width: 6px;
            border-radius: 999px;
            background: linear-gradient(to top, #3b82f6, #22d3ee);
            transform-origin: bottom;
            animation: pulseWave 0.9s ease-in-out infinite;
        }
        .voice-wave-bar:nth-child(2) { animation-delay: 0.08s; }
        .voice-wave-bar:nth-child(3) { animation-delay: 0.16s; }
        .voice-wave-bar:nth-child(4) { animation-delay: 0.24s; }
        .voice-wave-bar:nth-child(5) { animation-delay: 0.32s; }
        .voice-wave-bar:nth-child(6) { animation-delay: 0.40s; }
        .voice-wave-bar:nth-child(7) { animation-delay: 0.48s; }
        .voice-wave-bar:nth-child(8) { animation-delay: 0.56s; }
        .voice-wave-bar:nth-child(9) { animation-delay: 0.64s; }

        .voice-overlay-active .voice-wave-bar {
            animation-duration: 0.55s;
        }
        .voice-overlay-speaking .voice-wave-bar {
            background: linear-gradient(to top, #22c55e, #34d399);
            animation-duration: 0.35s;
        }

        .drop-active {
            border-color: rgb(59 130 246) !important;
            background: rgb(239 246 255) !important;
        }
        .drop-active-purple {
            border-color: rgb(168 85 247) !important;
            background: rgb(250 245 255) !important;
        }
    </style>
</head>
<body class="bg-white text-slate-900 selection:bg-blue-100 selection:text-blue-900 flex flex-col min-h-screen">

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2 cursor-pointer" onclick="app.navigate('home')">
                    <div class="bg-blue-600 p-2 rounded-lg">
                        <i data-lucide="activity" class="w-6 h-6 text-white"></i>
                    </div>
                    <span class="text-xl font-bold bg-gradient-to-r from-blue-700 to-cyan-600 bg-clip-text text-transparent">
                        PulseNova
                    </span>
                </div>

                <div class="hidden md:flex space-x-1">
                    <button onclick="app.navigate('home')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="home">
                        <i data-lucide="brain" class="w-4 h-4"></i> Home
                    </button>
                    <button onclick="app.navigate('triage')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="triage">
                        <i data-lucide="message-square" class="w-4 h-4"></i> Triage
                    </button>
                    <button onclick="app.navigate('vitals')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="vitals">
                        <i data-lucide="heart-pulse" class="w-4 h-4"></i> Vitals
                    </button>
                    <button onclick="app.navigate('xray')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="xray">
                        <i data-lucide="scan-line" class="w-4 h-4"></i> X-Ray
                    </button>
                    <button onclick="app.navigate('labs')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="labs">
                        <i data-lucide="microscope" class="w-4 h-4"></i> Lab Translator
                    </button>
                    <button onclick="app.navigate('care')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="care">
                        <i data-lucide="map-pin" class="w-4 h-4"></i> Find Care
                    </button>
                    <button onclick="app.navigate('about')" class="nav-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-500 hover:text-blue-600 hover:bg-slate-50" data-page="about">
                        <i data-lucide="info" class="w-4 h-4"></i> About
                    </button>
                </div>

                <button class="md:hidden text-slate-600 p-2" onclick="app.toggleMobileMenu()">
                    <i data-lucide="menu" id="menu-icon"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-100 py-2 shadow-lg absolute w-full left-0 top-16 z-40">
            <button onclick="app.navigate('home')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="brain" class="w-4 h-4"></i> Home</button>
            <button onclick="app.navigate('triage')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="message-square" class="w-4 h-4"></i> Triage</button>
            <button onclick="app.navigate('vitals')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="heart-pulse" class="w-4 h-4"></i> Vitals</button>
            <button onclick="app.navigate('xray')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="scan-line" class="w-4 h-4"></i> X-Ray</button>
            <button onclick="app.navigate('labs')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="microscope" class="w-4 h-4"></i> Labs</button>
            <button onclick="app.navigate('care')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="map-pin" class="w-4 h-4"></i> Care Finder</button>
            <button onclick="app.navigate('about')" class="block w-full text-left px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-3"><i data-lucide="info" class="w-4 h-4"></i> About</button>
        </div>
    </nav>

    <main id="app-content" class="flex-1 relative">

        <section id="page-home" class="page-section animate-fade-in">
            <div class="bg-gradient-to-b from-blue-50 to-white py-20 px-4">
                <div class="max-w-4xl mx-auto text-center space-y-6">
                    <div class="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-4 py-1.5 rounded-full text-sm font-semibold">
                        <i data-lucide="brain" class="w-4 h-4"></i> AI-Powered Health Assistant
                    </div>
                    <h1 class="text-4xl md:text-6xl font-extrabold text-slate-900 tracking-tight">
                        Clarity for your <span class="text-blue-600">health concerns.</span>
                    </h1>
                    <p class="text-lg md:text-xl text-slate-600 max-w-2xl mx-auto leading-relaxed">
                        PulseNova uses advanced AI to triage symptoms, analyze medical imaging, translate complex lab results, and even check your pulse directly from your device.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center pt-4">
                        <button onclick="app.navigate('triage')" class="flex items-center justify-center gap-2 bg-blue-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 hover:shadow-xl hover:-translate-y-0.5">
                            Start Symptom Check <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                        <button onclick="app.navigate('care')" class="flex items-center justify-center gap-2 bg-white text-slate-700 border border-slate-200 px-8 py-4 rounded-xl font-bold hover:bg-slate-50 transition-all">
                            Find Care Nearby
                        </button>
                    </div>
                </div>
            </div>

            <div class="py-20 px-4 max-w-6xl mx-auto">
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="bg-slate-50 w-14 h-14 rounded-xl flex items-center justify-center mb-4"><i data-lucide="message-square" class="w-8 h-8 text-indigo-500"></i></div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Smart Triage</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">Interactive chat with voice & image support that understands symptoms.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="bg-slate-50 w-14 h-14 rounded-xl flex items-center justify-center mb-4"><i data-lucide="heart-pulse" class="w-8 h-8 text-red-500"></i></div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Pulse Check</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">Check your estimated heart rate using just your phone's camera.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="bg-slate-50 w-14 h-14 rounded-xl flex items-center justify-center mb-4"><i data-lucide="file-image" class="w-8 h-8 text-emerald-500"></i></div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">X-Ray Analysis</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">Upload scans for an instant summary of visible structures.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="bg-slate-50 w-14 h-14 rounded-xl flex items-center justify-center mb-4"><i data-lucide="map-pin" class="w-8 h-8 text-orange-500"></i></div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Care Finder</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">Find hospitals, urgent care, pharmacies, dentists and more nearby.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-triage" class="page-section hidden h-[calc(100vh-64px)] p-4">
            <div class="max-w-4xl mx-auto h-full flex flex-col bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="p-4 border-b border-slate-100 bg-slate-50 flex items-center justify-between flex-shrink-0">
                    <div class="flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="font-semibold text-slate-700">Triage Assistant</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="app.toggleSpeechOutput()" id="btn-speech-toggle" class="p-2 rounded-full hover:bg-slate-200 text-slate-400 transition-colors" title="Toggle Voice Response">
                            <i data-lucide="volume-x" class="w-4 h-4"></i>
                        </button>
                        <button onclick="app.resetChat()" class="text-xs text-slate-500 hover:text-blue-600 underline">Reset Chat</button>
                    </div>
                </div>

                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50"></div>

                <div class="p-4 bg-white border-t border-slate-100 flex-shrink-0">
                    <div id="chat-image-preview-container" class="hidden mb-3 relative inline-block">
                        <img id="chat-image-preview" src="" alt="Preview" class="h-20 rounded-lg border border-slate-200 shadow-sm">
                        <button onclick="app.clearChatImage()" class="absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-1 hover:bg-red-500 transition-colors">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    </div>

                    <div class="flex items-end gap-2">
                        <input type="file" id="chat-file-input" class="hidden" accept="image/*" onchange="app.handleChatImageSelect(this)">
                        <button onclick="document.getElementById('chat-file-input').click()" class="p-3 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors mb-[2px]">
                            <i data-lucide="image" class="w-5 h-5"></i>
                        </button>
                        <button onclick="app.openVoiceOverlay()" id="btn-mic" class="p-3 rounded-xl transition-all mb-[2px] text-slate-400 hover:text-blue-600 hover:bg-blue-50" title="Voice mode">
                            <i data-lucide="mic" class="w-5 h-5"></i>
                        </button>
                        <div class="flex-1 bg-slate-50 border border-slate-200 rounded-xl flex items-center px-4 py-2 focus-within:ring-2 focus-within:ring-blue-500/20 focus-within:border-blue-500 transition-all">
                            <textarea id="chat-input" rows="1" placeholder="Type symptoms..." class="w-full bg-transparent border-none focus:outline-none text-slate-800 resize-none max-h-32 text-sm py-2 placeholder:text-slate-400" onkeydown="if(event.key === 'Enter' && !event.shiftKey){ event.preventDefault(); app.sendMessage(); }"></textarea>
                        </div>
                        <button onclick="app.sendMessage()" id="btn-send" class="p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20 mb-[2px]">
                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <div class="mt-2 text-[11px] text-slate-400">
                        Backend: <span class="font-mono">/api/triage</span> & <span class="font-mono">/api/vision</span> (Amazon Nova via Bedrock)
                    </div>
                </div>
            </div>
        </section>

        <section id="page-vitals" class="page-section hidden p-4 min-h-[calc(100vh-64px)]">
            <div class="max-w-3xl mx-auto space-y-6">
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold text-slate-900 mb-2">Pulse Monitor</h1>
                    <p class="text-slate-500 text-sm">Measure your estimated heart rate using your device's camera.</p>
                </div>

                <div class="bg-amber-50 border border-amber-200 text-amber-800 p-4 rounded-xl text-sm leading-relaxed flex gap-3 shadow-sm">
                    <i data-lucide="smartphone" class="w-5 h-5 shrink-0 mt-0.5"></i>
                    <div>
                        <p class="font-semibold mb-1">Best on phone (not laptop)</p>
                        <p class="text-amber-700">
                            This feature works best on a smartphone because it needs a rear camera and usually the flashlight/torch. On laptops, pulse detection may be inaccurate or unavailable.
                        </p>
                    </div>
                </div>

                <div class="bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded-xl text-sm leading-relaxed flex gap-3 shadow-sm">
                    <i data-lucide="info" class="w-5 h-5 shrink-0 mt-0.5"></i>
                    <div>
                        <p class="font-semibold mb-1">How to use:</p>
                        <ul class="list-disc ml-4 space-y-1 text-blue-700">
                            <li>Place your fingertip gently over the back camera lens.</li>
                            <li>Ensure you are in a well-lit area (or the flashlight turns on).</li>
                            <li>Hold steady and wait for the graph to stabilize.</li>
                        </ul>
                        <p class="mt-2 text-xs opacity-80 border-t border-blue-200 pt-2"><strong class="font-bold">Privacy Note:</strong> Video processing happens entirely on your device. No video is recorded or sent to any server. Not a medical diagnostic tool.</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col items-center p-6">
                    <div class="w-full relative bg-slate-900 rounded-xl overflow-hidden mb-6 flex flex-col items-center justify-center min-h-[250px] shadow-inner">
                        <canvas id="ppg-graph" class="w-full h-40 opacity-80"></canvas>
                        <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                            <div class="text-6xl font-bold text-white drop-shadow-md flex items-baseline gap-1">
                                <span id="bpm-display">--</span>
                                <span class="text-xl text-slate-300 font-normal">BPM</span>
                            </div>
                            <div id="vitals-status" class="text-sm text-slate-400 mt-2 bg-slate-900/60 px-3 py-1 rounded-full">Ready to start</div>
                        </div>
                        <video id="vitals-video" class="hidden" playsinline autoplay></video>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="app.startVitals()" id="btn-start-vitals" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-md flex items-center gap-2">
                            <i data-lucide="play" class="w-5 h-5"></i> Start Monitor
                        </button>
                        <button onclick="app.stopVitals()" id="btn-stop-vitals" class="bg-slate-100 text-slate-700 border border-slate-300 px-8 py-3 rounded-xl font-bold hover:bg-slate-200 transition-all flex items-center gap-2 hidden">
                            <i data-lucide="square" class="w-5 h-5"></i> Stop
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-xray" class="page-section hidden p-4 min-h-[calc(100vh-64px)]">
            <div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i data-lucide="scan-line" class="w-5 h-5 text-blue-600"></i> Image Upload
                        </h2>
                        <div onclick="document.getElementById('xray-input').click()"
                             id="xray-dropzone"
                             tabindex="0"
                             role="button"
                             onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();document.getElementById('xray-input').click();}"
                             class="border-2 border-dashed border-slate-300 hover:border-blue-400 hover:bg-slate-50 rounded-xl h-[400px] flex flex-col items-center justify-center cursor-pointer transition-all overflow-hidden relative">
                            <div id="xray-placeholder" class="text-center p-6">
                                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="upload" class="w-8 h-8 text-blue-600"></i>
                                </div>
                                <p class="font-semibold text-slate-700">Drag & drop or click to upload X-Ray/MRI</p>
                                <p class="text-sm text-slate-400 mt-2">JPG, PNG, HEIC image files</p>
                            </div>
                            <img id="xray-preview-img" class="hidden h-full w-full object-contain bg-slate-900" />
                            <input type="file" id="xray-input" class="hidden" accept="image/*" onchange="app.handleXrayUpload(this)">
                        </div>
                        <button onclick="app.analyzeXray()" id="btn-analyze-xray" disabled class="w-full mt-4 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md flex items-center justify-center gap-2">
                            <i data-lucide="activity" class="w-5 h-5"></i> Analyze Scan
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm flex flex-col h-[600px] lg:h-auto overflow-hidden">
                    <div class="p-6 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
                        <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <i data-lucide="file-text" class="w-5 h-5 text-blue-600"></i> Medical Report
                        </h2>
                        <button onclick="window.print()" class="text-xs bg-white border border-slate-200 text-slate-600 px-3 py-1.5 rounded-lg font-medium hover:bg-slate-50 flex items-center gap-1 transition-colors">
                            <i data-lucide="printer" class="w-3 h-3"></i> Print
                        </button>
                    </div>
                    <div id="xray-result" class="flex-1 p-6 overflow-y-auto text-slate-700 prose prose-blue max-w-none">
                        <div class="flex flex-col items-center justify-center h-full text-slate-400 gap-4 opacity-60">
                            <i data-lucide="file-image" class="w-16 h-16"></i>
                            <p class="text-center">Upload and scan an image to generate<br/>a detailed medical report.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-labs" class="page-section hidden p-4 min-h-[calc(100vh-64px)]">
            <div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i data-lucide="microscope" class="w-5 h-5 text-purple-600"></i> Upload Lab Results
                        </h2>
                        <div onclick="document.getElementById('lab-input').click()"
                             id="lab-dropzone"
                             tabindex="0"
                             role="button"
                             onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();document.getElementById('lab-input').click();}"
                             class="border-2 border-dashed border-slate-300 hover:border-purple-400 hover:bg-slate-50 rounded-xl h-[400px] flex flex-col items-center justify-center cursor-pointer transition-all overflow-hidden relative">
                            <div id="lab-placeholder" class="text-center p-6">
                                <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="upload" class="w-8 h-8 text-purple-600"></i>
                                </div>
                                <p class="font-semibold text-slate-700">Drag & drop or click to upload Report</p>
                                <p class="text-sm text-slate-400 mt-2">Blood Work, Urine Test, etc.</p>
                            </div>
                            <img id="lab-preview-img" class="hidden h-full w-full object-contain" />
                            <input type="file" id="lab-input" class="hidden" accept="image/*" onchange="app.handleLabUpload(this)">
                        </div>
                        <button onclick="app.analyzeLabs()" id="btn-analyze-lab" disabled class="w-full mt-4 bg-purple-600 text-white py-3 rounded-xl font-bold hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md flex items-center justify-center gap-2">
                            <i data-lucide="activity" class="w-5 h-5"></i> Translate Report
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm flex flex-col h-[600px] lg:h-auto overflow-hidden">
                    <div class="p-6 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
                        <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <i data-lucide="file-text" class="w-5 h-5 text-purple-600"></i> Interpretation
                        </h2>
                        <button onclick="window.print()" class="text-xs bg-white border border-slate-200 text-slate-600 px-3 py-1.5 rounded-lg font-medium hover:bg-slate-50 flex items-center gap-1 transition-colors">
                            <i data-lucide="printer" class="w-3 h-3"></i> Print
                        </button>
                    </div>
                    <div id="lab-result" class="flex-1 p-6 overflow-y-auto text-slate-700 prose prose-purple max-w-none">
                        <div class="flex flex-col items-center justify-center h-full text-slate-400 gap-4 opacity-60">
                            <i data-lucide="file-text" class="w-16 h-16"></i>
                            <p class="text-center">Upload a document to get a<br/>plain English explanation.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-care" class="page-section hidden p-4 animate-fade-in">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold text-slate-900 mb-2">Find Care Nearby</h1>
                    <p class="text-slate-500">Locate trusted medical providers in your area.</p>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-4 flex flex-col gap-3">
                    <div class="grid md:grid-cols-12 gap-3">
                        <div class="md:col-span-6 relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-5 h-5 text-slate-400"></i>
                            <input type="text" id="care-search" placeholder="City, address, or ZIP..." class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none">
                        </div>

                        <div class="md:col-span-3 relative">
                            <i data-lucide="filter" class="absolute left-3 top-3 w-4 h-4 text-slate-400"></i>
                            <input type="text" id="provider-filter" placeholder="Filter results..." oninput="app.renderProviders()" class="w-full pl-9 pr-3 py-2.5 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none">
                        </div>

                        <div class="md:col-span-3 flex gap-2">
                            <button onclick="app.searchCareByText()" id="btn-search-care" class="flex-1 px-4 py-2.5 bg-white border border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50 flex items-center gap-2 justify-center">
                                <i data-lucide="search" class="w-4 h-4"></i> Search
                            </button>
                            <button onclick="app.locateUser()" id="btn-locate" class="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 flex items-center gap-2 justify-center transition-colors">
                                <i data-lucide="navigation" class="w-4 h-4"></i> Near Me
                            </button>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-3">
                        <select id="care-filter" onchange="app.renderProviders()" class="px-4 py-2.5 border border-slate-200 rounded-xl bg-white outline-none focus:ring-2 focus:ring-blue-500/20">
                            <option value="All">All Providers</option>
                            <option value="ER">Emergency Room</option>
                            <option value="Urgent Care">Urgent Care</option>
                            <option value="Hospital">Hospital</option>
                            <option value="Primary Care">Primary Care</option>
                            <option value="Clinic">Clinic</option>
                            <option value="Pharmacy">Pharmacy</option>
                            <option value="Dentist">Dentist</option>
                            <option value="Pediatrician">Pediatrician</option>
                        </select>
                        <div id="care-status" class="text-sm text-slate-500 flex items-center" aria-live="polite"></div>
                    </div>
                </div>

                <div id="care-map-host" class="hidden h-1 w-1"></div>
                <div id="providers-list" class="grid md:grid-cols-2 gap-4"></div>
            </div>
        </section>

        <section id="page-about" class="page-section hidden p-4 animate-fade-in">
            <div class="max-w-4xl mx-auto py-12">
                <div class="text-center mb-16">
                    <h1 class="text-3xl font-bold text-slate-900 mb-4">About PulseNova</h1>
                    <p class="text-slate-600 max-w-2xl mx-auto">
                        We are bridging the gap between uncertainty and care. PulseNova leverages cutting-edge AI to provide accessible, immediate medical information to everyone, everywhere.
                    </p>
                </div>
                <div class="space-y-12">
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="flex-1 space-y-4">
                            <div class="inline-block p-3 bg-blue-100 rounded-lg text-blue-700 mb-2"><i data-lucide="heart-pulse" class="w-6 h-6"></i></div>
                            <h2 class="text-2xl font-bold text-slate-800">Our Mission</h2>
                            <p class="text-slate-600 leading-relaxed">To reduce medical anxiety and ER overcrowding by providing an intelligent first-line triage tool. We believe everyone deserves to know "what to do next" the moment they feel unwell.</p>
                        </div>
                        <div class="flex-1 bg-slate-100 h-64 w-full rounded-2xl flex items-center justify-center overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&q=80&w=800" alt="Medical Team" class="w-full h-full object-cover opacity-90" />
                        </div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-100"><h3 class="font-bold text-slate-900 mb-2">Accessibility</h3><p class="text-sm text-slate-600">Free, 24/7 access to medical guidance without insurance barriers.</p></div>
                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-100"><h3 class="font-bold text-slate-900 mb-2">Privacy</h3><p class="text-sm text-slate-600">We do not store your personal health data. Your chats are ephemeral.</p></div>
                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-100"><h3 class="font-bold text-slate-900 mb-2">Technology</h3><p class="text-sm text-slate-600">Powered by Amazon Nova (Bedrock) for text + vision and Google Maps Places for care discovery.</p></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Voice overlay -->
    <div id="voice-overlay" class="hidden fixed inset-0 bg-black z-[100] text-white">
        <div id="voice-overlay-shell" class="h-full w-full flex flex-col items-center justify-between py-8 px-6">
            <div class="w-full flex items-center justify-between">
                <div class="text-sm text-slate-300 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                    Voice Mode
                </div>
                <button onclick="app.closeVoiceOverlay()" class="p-2 rounded-full bg-white/10 hover:bg-white/20">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center w-full max-w-md">
                <div id="voice-wave-container" class="flex items-end gap-1 h-32 mb-6">
                    <div class="voice-wave-bar h-12"></div>
                    <div class="voice-wave-bar h-20"></div>
                    <div class="voice-wave-bar h-14"></div>
                    <div class="voice-wave-bar h-24"></div>
                    <div class="voice-wave-bar h-16"></div>
                    <div class="voice-wave-bar h-28"></div>
                    <div class="voice-wave-bar h-15"></div>
                    <div class="voice-wave-bar h-22"></div>
                    <div class="voice-wave-bar h-13"></div>
                </div>

                <div id="voice-overlay-state" class="text-lg font-semibold mb-2">Tap to speak</div>
                <div id="voice-overlay-subtitle" class="text-sm text-slate-400 text-center px-4">
                    I will listen and type your words into the chat.
                </div>
                <div id="voice-transcript" class="mt-4 min-h-[48px] text-center text-slate-200 text-sm max-w-sm"></div>
            </div>

            <div class="w-full max-w-md flex gap-3">
                <button id="voice-toggle-btn" onclick="app.toggleListening()" class="flex-1 bg-blue-600 hover:bg-blue-700 rounded-2xl py-4 font-semibold flex items-center justify-center gap-2">
                    <i data-lucide="mic" class="w-5 h-5"></i> Start Listening
                </button>
                <button onclick="app.closeVoiceOverlay()" class="px-4 rounded-2xl bg-white/10 hover:bg-white/20">
                    <i data-lucide="chevron-down" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        class PulseNovaApp {
            constructor() {
                this.messages = [
                    { role: 'assistant', text: "Hello. I'm PulseNova. Please describe your symptoms in detail, or send me a photo if relevant." }
                ];

                this.chatImage = null;
                this.xrayImage = null;
                this.labImage = null;

                this.isListening = false;
                this.speakOutput = false;
                this.recognition = null;
                this.chatBusy = false;

                this.voiceOverlayOpen = false;
                this.isSpeakingNow = false;

                this.googleMapsReady = false;
                this.googleMapsLoading = false;
                this.gmap = null;
                this.placesService = null;
                this.geocoder = null;
                this.userLocation = null;

                this.providers = [];
                this.care = {
                    userLat: null,
                    userLon: null,
                    centerLabel: null
                };

                this.vitals = {
                    stream: null,
                    video: null,
                    canvas: null,
                    ctx: null,
                    processCanvas: document.createElement('canvas'),
                    processCtx: null,
                    animId: null,
                    redValues: [],
                    bpmHistory: [],
                    lastPeakTime: 0,
                    isMonitoring: false
                };
                this.vitals.processCanvas.width = 10;
                this.vitals.processCanvas.height = 10;
                this.vitals.processCtx = this.vitals.processCanvas.getContext('2d', { willReadFrequently: true });
                this.processVitalsFrame = this.processVitalsFrame.bind(this);

                this.initSpeech();
                this.initCareSearch();
                this.initDropzones();
                this.renderChat();
                this.renderProviders();
                this.updateSpeechToggleUI();
                this.updateVoiceOverlayUI();
            }

            // =========================
            // NAVIGATION
            // =========================
            navigate(pageId) {
                if (pageId !== 'vitals' && this.vitals.isMonitoring) this.stopVitals();

                document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
                document.getElementById(`page-${pageId}`).classList.remove('hidden');

                document.querySelectorAll('.nav-btn').forEach(el => {
                    if (el.dataset.page === pageId) {
                        el.classList.add('bg-blue-50', 'text-blue-600');
                        el.classList.remove('text-slate-500');
                    } else {
                        el.classList.remove('bg-blue-50', 'text-blue-600');
                        el.classList.add('text-slate-500');
                    }
                });

                document.getElementById('mobile-menu').classList.add('hidden');

                if (pageId !== 'triage') {
                    this.closeVoiceOverlay();
                    window.speechSynthesis.cancel();
                }
            }

            toggleMobileMenu() {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            }

            // =========================
            // GOOGLE MAPS / CARE FINDER
            // =========================
            async ensureGoogleMaps() {
                if (this.googleMapsReady) return;
                if (this.googleMapsLoading) return this.googleMapsLoading;

                this.googleMapsLoading = new Promise(async (resolve, reject) => {
                    try {
                        if (window.google && window.google.maps && window.google.maps.places) {
                            this.googleMapsReady = true;
                            this.initGoogleServices();
                            resolve();
                            return;
                        }

                        const cfgRes = await fetch('/config');
                        if (!cfgRes.ok) throw new Error(`Failed to fetch /config (${cfgRes.status})`);

                        const cfg = await cfgRes.json();
                        const apiKey = cfg.google_maps_api_key;
                        if (!apiKey) throw new Error("GOOGLE_MAPS_API_KEY is not set on the server.");

                        window.__pulseNovaMapsInit = () => {
                            this.googleMapsReady = true;
                            try {
                                this.initGoogleServices();
                                resolve();
                            } catch (e) {
                                reject(e);
                            } finally {
                                try { delete window.__pulseNovaMapsInit; } catch (_) {}
                            }
                        };

                        const existing = document.getElementById('pulse-nova-gmaps');
                        if (existing) return;

                        const script = document.createElement('script');
                        script.id = 'pulse-nova-gmaps';
                        script.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(apiKey)}&libraries=places,geometry&callback=__pulseNovaMapsInit&loading=async`;
                        script.async = true;
                        script.defer = true;
                        script.onerror = () => reject(new Error("Failed to load Google Maps JS SDK"));
                        document.head.appendChild(script);

                    } catch (err) {
                        reject(err);
                    }
                });

                return this.googleMapsLoading;
            }

            initGoogleServices() {
                if (this.gmap) return;
                const host = document.getElementById('care-map-host');
                this.gmap = new google.maps.Map(host, {
                    center: { lat: 41.7658, lng: -72.6734 },
                    zoom: 12,
                    disableDefaultUI: true
                });
                this.placesService = new google.maps.places.PlacesService(this.gmap); // legacy warning is okay
                this.geocoder = new google.maps.Geocoder();
            }

            setCareStatus(text, isError = false) {
                const el = document.getElementById('care-status');
                if (!el) return;
                el.textContent = text || "";
                el.className = `text-sm flex items-center ${isError ? 'text-red-600' : 'text-slate-500'}`;
            }

            initCareSearch() {
                const input = document.getElementById('care-search');
                if (!input) return;
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.searchCareByText();
                    }
                });
            }

            async searchCareByText() {
                const input = document.getElementById('care-search');
                const query = (input?.value || '').trim();
                const btn = document.getElementById('btn-search-care');

                if (!query) {
                    this.setCareStatus("Enter a city or ZIP code.", true);
                    return;
                }

                try {
                    btn.disabled = true;
                    btn.classList.add('opacity-70');
                    this.setCareStatus("Finding area...");
                    await this.ensureGoogleMaps();

                    const geo = await new Promise((resolve, reject) => {
                        this.geocoder.geocode({ address: query }, (results, status) => {
                            if (status === "OK" && results && results.length) resolve(results[0]);
                            else reject(new Error(`Geocoding failed: ${status}`));
                        });
                    });

                    const loc = geo.geometry.location;
                    this.userLocation = { lat: loc.lat(), lng: loc.lng() };
                    this.care.userLat = this.userLocation.lat;
                    this.care.userLon = this.userLocation.lng;
                    this.care.centerLabel = geo.formatted_address || query;

                    if (this.gmap) {
                        this.gmap.setCenter(this.userLocation);
                        this.gmap.setZoom(12);
                    }

                    await this.fetchNearbyProviders(this.userLocation.lat, this.userLocation.lng);

                } catch (err) {
                    console.error("searchCareByText failed:", err);
                    this.setCareStatus("Could not search this area. Try another city/ZIP.", true);
                } finally {
                    btn.disabled = false;
                    btn.classList.remove('opacity-70');
                }
            }

            async locateUser() {
                const btn = document.getElementById('btn-locate');
                const original = btn.innerHTML;

                btn.disabled = true;
                btn.innerHTML = 'Locating...';
                this.setCareStatus("Requesting your location...");

                try {
                    await this.ensureGoogleMaps();

                    const pos = await new Promise((resolve, reject) => {
                        if (!navigator.geolocation) {
                            reject(new Error("Geolocation is not supported on this device/browser."));
                            return;
                        }
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 30000
                        });
                    });

                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;

                    this.care.userLat = lat;
                    this.care.userLon = lon;
                    this.care.centerLabel = "your location";
                    await this.fetchNearbyProviders(lat, lon);

                } catch (e) {
                    console.error(e);
                    this.setCareStatus("Couldn't get your location. Try Search with ZIP/city.", true);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = original;
                    lucide.createIcons();
                }
            }

            nearbySearchPromise(request) {
                return new Promise((resolve, reject) => {
                    this.placesService.nearbySearch(request, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK || status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                            resolve(results || []);
                        } else {
                            reject(new Error(`Places search failed: ${status}`));
                        }
                    });
                });
            }

            textSearchPromise(request) {
                return new Promise((resolve, reject) => {
                    this.placesService.textSearch(request, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK || status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                            resolve(results || []);
                        } else {
                            reject(new Error(`Places text search failed: ${status}`));
                        }
                    });
                });
            }

            getDistanceMiles(lat1, lon1, lat2, lon2) {
                if (window.google?.maps?.geometry?.spherical) {
                    const a = new google.maps.LatLng(lat1, lon1);
                    const b = new google.maps.LatLng(lat2, lon2);
                    const meters = google.maps.geometry.spherical.computeDistanceBetween(a, b);
                    return meters / 1609.344;
                }
                const toRad = x => x * Math.PI / 180;
                const R = 6371000;
                const dLat = toRad(lat2 - lat1);
                const dLon = toRad(lon2 - lon1);
                const aa = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
                const c = 2 * Math.atan2(Math.sqrt(aa), Math.sqrt(1 - aa));
                return (R * c) / 1609.344;
            }

            normalizePlace(place, inferredType) {
                const loc = place.geometry?.location;
                const lat = typeof loc?.lat === 'function' ? loc.lat() : place.geometry?.location?.lat;
                const lon = typeof loc?.lng === 'function' ? loc.lng() : place.geometry?.location?.lng;

                let type = inferredType || 'Clinic';
                const types = place.types || [];
                const name = (place.name || '').toLowerCase();

                if (types.includes('hospital')) type = inferredType === 'Urgent Care' ? 'Urgent Care' : 'Hospital';
                if (types.includes('pharmacy')) type = 'Pharmacy';
                if (types.includes('dentist')) type = 'Dentist';
                if (name.includes('urgent care')) type = 'Urgent Care';
                if (name.includes('pediatric')) type = 'Pediatrician';
                if (name.includes('primary care') || name.includes('family medicine')) type = 'Primary Care';

                // Map large hospitals to ER for quick filtering if applicable
                if (type === 'Hospital' && (name.includes('emergency') || name.includes('er'))) {
                    type = 'ER';
                }

                const rating = place.rating || null;
                const address = place.vicinity || place.formatted_address || "Address unavailable";
                const distance = (this.care.userLat != null && this.care.userLon != null && lat != null && lon != null)
                    ? this.getDistanceMiles(this.care.userLat, this.care.userLon, lat, lon)
                    : null;

                return {
                    id: place.place_id,
                    name: place.name || "Unknown provider",
                    type,
                    address,
                    rating,
                    distance,
                    lat,
                    lon,
                    placeId: place.place_id
                };
            }

            dedupeProviders(list) {
                const seen = new Map();
                for (const p of list) {
                    if (!p?.id) continue;
                    if (!seen.has(p.id)) {
                        seen.set(p.id, p);
                    } else {
                        const ex = seen.get(p.id);
                        if (ex.type === 'Hospital' && p.type === 'Urgent Care') seen.set(p.id, p);
                    }
                }
                return Array.from(seen.values());
            }

            async fetchNearbyProviders(lat, lon) {
                this.setCareStatus("Searching nearby care options...");
                this.providers = [];
                this.renderProviders();

                try {
                    const center = new google.maps.LatLng(lat, lon);
                    this.gmap.setCenter(center);

                    const radiusMeters = 12000;

                    const [hospitals, pharmacies, dentists, urgentCare, primaryCare, pediatrics] = await Promise.all([
                        this.nearbySearchPromise({ location: center, radius: radiusMeters, type: 'hospital' }),
                        this.nearbySearchPromise({ location: center, radius: radiusMeters, type: 'pharmacy' }),
                        this.nearbySearchPromise({ location: center, radius: radiusMeters, type: 'dentist' }),
                        this.textSearchPromise({ location: center, radius: radiusMeters, query: 'urgent care' }),
                        this.textSearchPromise({ location: center, radius: radiusMeters, query: 'primary care clinic' }),
                        this.textSearchPromise({ location: center, radius: radiusMeters, query: 'pediatrician' })
                    ]);

                    let merged = [
                        ...hospitals.map(p => this.normalizePlace(p, 'Hospital')),
                        ...pharmacies.map(p => this.normalizePlace(p, 'Pharmacy')),
                        ...dentists.map(p => this.normalizePlace(p, 'Dentist')),
                        ...urgentCare.map(p => this.normalizePlace(p, 'Urgent Care')),
                        ...primaryCare.map(p => this.normalizePlace(p, 'Primary Care')),
                        ...pediatrics.map(p => this.normalizePlace(p, 'Pediatrician'))
                    ];

                    merged = this.dedupeProviders(merged);

                    merged.sort((a, b) => {
                        const da = (typeof a.distance === 'number') ? a.distance : 999;
                        const db = (typeof b.distance === 'number') ? b.distance : 999;
                        return da - db;
                    });

                    this.providers = merged.slice(0, 30);
                    this.renderProviders();

                    const visibleCount = this.getFilteredProviders().length;
                    const label = this.care.centerLabel ? ` near ${this.care.centerLabel}` : "";
                    this.setCareStatus(
                        this.providers.length
                            ? `Found ${this.providers.length} providers${label}. Showing ${visibleCount}.`
                            : `No providers found${label}. Try another ZIP/city.`
                    );

                } catch (e) {
                    console.error(e);
                    this.setCareStatus("Care search failed. Check your Maps API key and enabled APIs.", true);
                }
            }

            // =========================
            // NOVA BACKEND CALLS
            // =========================
            async callNovaTriage(history, userMessage, base64Image) {
                try {
                    let cleanHistory = (history || [])
                        .map(t => ({ role: t.role, text: (t.text || '').trim() }))
                        .filter(t => t.text);

                    while (cleanHistory.length && cleanHistory[0].role !== 'user') cleanHistory.shift();

                    const payload = {
                        message: userMessage || "",
                        history: cleanHistory,
                        image_base64: base64Image || null
                    };

                    const res = await fetch('/api/triage', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                    });

                    if (!res.ok) {
                        const err = await res.json().catch(() => ({}));
                        throw new Error(err.detail || `HTTP ${res.status}`);
                    }

                    const data = await res.json();
                    return data.text || "I didn't get a response.";
                } catch (e) {
                    console.error(e);
                    return "I'm having trouble connecting to the server. If this is an emergency, call 911.";
                }
            }

            async callNovaVision(base64Data, prompt) {
                try {
                    const payload = { image_base64: base64Data, prompt };
                    const res = await fetch('/api/vision', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                    });

                    if (!res.ok) {
                        const err = await res.json().catch(() => ({}));
                        throw new Error(err.detail || `HTTP ${res.status}`);
                    }

                    const data = await res.json();
                    return data.text || "I didn't get a response.";
                } catch (e) {
                    console.error(e);
                    return "Analysis failed. Please try a clearer image.";
                }
            }

            // =========================
            // TRIAGE CHAT
            // =========================
            renderChat() {
                const container = document.getElementById('chat-messages');
                container.innerHTML = '';

                this.messages.forEach(msg => {
                    const isUser = msg.role === 'user';
                    const div = document.createElement('div');
                    div.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;

                    const wrapper = document.createElement('div');
                    wrapper.className = 'max-w-[85%] space-y-2';

                    if (msg.image) {
                        const imgWrap = document.createElement('div');
                        imgWrap.className = `p-2 rounded-2xl ${isUser ? 'bg-blue-600 rounded-tr-none' : 'bg-white border'}`;
                        const img = document.createElement('img');
                        img.src = `data:image/png;base64,${msg.image}`;
                        img.className = 'max-h-48 rounded-lg object-cover';
                        img.alt = 'Uploaded image';
                        imgWrap.appendChild(img);
                        wrapper.appendChild(imgWrap);
                    }

                    if (msg.text) {
                        const bubble = document.createElement('div');
                        bubble.className = `rounded-2xl px-4 py-3 text-sm leading-relaxed ${isUser ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-white border border-slate-200 text-slate-800 rounded-tl-none shadow-sm'}`;
                        bubble.innerHTML = this.formatText(msg.text);
                        wrapper.appendChild(bubble);
                    }

                    div.appendChild(wrapper);
                    container.appendChild(div);
                });

                container.scrollTop = container.scrollHeight;
            }

            async sendMessage() {
                if (this.chatBusy) return;

                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                const image = this.chatImage;

                if (!text && !image) return;

                this.chatBusy = true;
                const sendBtn = document.getElementById('btn-send');
                sendBtn.disabled = true;
                sendBtn.classList.add('opacity-60');

                window.speechSynthesis.cancel();
                this.setSpeakingState(false);

                this.messages.push({ role: 'user', text, image });
                this.renderChat();

                input.value = '';
                this.clearChatImage();
                this.showLoading();

                const history = this.messages.slice(0, -1).map(m => ({ role: m.role, text: m.text }));
                const responseText = await this.callNovaTriage(history, text, image);

                this.removeLoading();
                this.messages.push({ role: 'assistant', text: responseText });
                this.renderChat();

                if (this.speakOutput) this.speak(responseText);

                this.chatBusy = false;
                sendBtn.disabled = false;
                sendBtn.classList.remove('opacity-60');
            }

            showLoading() {
                const container = document.getElementById('chat-messages');
                const div = document.createElement('div');
                div.id = 'chat-loading';
                div.className = 'flex justify-start';
                div.innerHTML = `
                    <div class="bg-white border border-slate-200 rounded-2xl rounded-tl-none px-4 py-4 shadow-sm flex gap-1 items-center h-10">
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                    </div>
                `;
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;
            }

            removeLoading() {
                const el = document.getElementById('chat-loading');
                if (el) el.remove();
            }

            handleChatImageSelect(input) {
                const file = input.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = () => {
                    const fullData = reader.result;
                    this.chatImage = fullData.split(',')[1];
                    document.getElementById('chat-image-preview').src = fullData;
                    document.getElementById('chat-image-preview-container').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            clearChatImage() {
                this.chatImage = null;
                document.getElementById('chat-image-preview').src = '';
                document.getElementById('chat-image-preview-container').classList.add('hidden');
                document.getElementById('chat-file-input').value = '';
            }

            resetChat() {
                window.speechSynthesis.cancel();
                this.setSpeakingState(false);
                this.messages = [
                    { role: 'assistant', text: "Hello. I'm PulseNova. Please describe your symptoms in detail." }
                ];
                this.renderChat();
            }

            // =========================
            // VOICE MODE + SPEECH
            // =========================
            initSpeech() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        window.speechSynthesis.cancel();
                        this.setSpeakingState(false);

                        const micBtn = document.getElementById('btn-mic');
                        if (micBtn) micBtn.classList.add('text-red-600', 'bg-red-50', 'animate-pulse');

                        this.setVoiceOverlayState('Listening...', 'Speak now. Ill type it in the chat.', true);
                        this.updateVoiceOverlayUI();
                    };

                    this.recognition.onend = () => {
                        this.isListening = false;
                        const micBtn = document.getElementById('btn-mic');
                        if (micBtn) micBtn.classList.remove('text-red-600', 'bg-red-50', 'animate-pulse');

                        if (this.voiceOverlayOpen) {
                            this.setVoiceOverlayState('Voice mode', 'Tap the mic button to speak again.', false);
                        }
                        this.updateVoiceOverlayUI();
                    };

                    this.recognition.onresult = (event) => {
                        const t = (event.results?.[0]?.[0]?.transcript || '').trim();
                        const input = document.getElementById('chat-input');
                        if (t && input) {
                            input.value = input.value ? input.value + ' ' + t : t;
                            document.getElementById('voice-transcript').textContent = `"${t}"`;
                        }
                    };

                    this.recognition.onerror = (e) => {
                        console.warn('Speech recognition error:', e);
                        this.isListening = false;
                        const micBtn = document.getElementById('btn-mic');
                        if (micBtn) micBtn.classList.remove('text-red-600', 'bg-red-50', 'animate-pulse');

                        this.setVoiceOverlayState('Could not hear you', 'Try again or type your symptoms.', false);
                        this.updateVoiceOverlayUI();
                    };
                }
            }

            openVoiceOverlay() {
                this.voiceOverlayOpen = true;
                const overlay = document.getElementById('voice-overlay');
                overlay.classList.remove('hidden');
                this.setVoiceOverlayState('Voice mode', 'Tap Start Listening and speak naturally.', false);
                document.getElementById('voice-transcript').textContent = '';
                this.updateVoiceOverlayUI();
                lucide.createIcons();
            }

            closeVoiceOverlay() {
                this.voiceOverlayOpen = false;
                if (this.isListening && this.recognition) {
                    try { this.recognition.stop(); } catch (_) {}
                }
                const overlay = document.getElementById('voice-overlay');
                overlay.classList.add('hidden');
                this.updateVoiceOverlayUI();
            }

            toggleListening() {
                if (!this.recognition) {
                    alert("Browser does not support speech recognition.");
                    return;
                }
                if (this.isListening) this.recognition.stop();
                else this.recognition.start();
            }

            setVoiceOverlayState(title, subtitle, active) {
                const titleEl = document.getElementById('voice-overlay-state');
                const subEl = document.getElementById('voice-overlay-subtitle');
                if (titleEl) titleEl.textContent = title;
                if (subEl) subEl.textContent = subtitle;

                const overlay = document.getElementById('voice-overlay');
                if (!overlay) return;
                overlay.classList.toggle('voice-overlay-active', !!active);
            }

            updateVoiceOverlayUI() {
                const btn = document.getElementById('voice-toggle-btn');
                const overlay = document.getElementById('voice-overlay');
                if (btn) {
                    btn.innerHTML = this.isListening
                        ? `<i data-lucide="mic-off" class="w-5 h-5"></i> Stop Listening`
                        : `<i data-lucide="mic" class="w-5 h-5"></i> Start Listening`;
                    btn.classList.toggle('bg-red-600', this.isListening);
                    btn.classList.toggle('hover:bg-red-700', this.isListening);
                    btn.classList.toggle('bg-blue-600', !this.isListening);
                    btn.classList.toggle('hover:bg-blue-700', !this.isListening);
                }
                if (overlay) overlay.classList.toggle('voice-overlay-speaking', this.isSpeakingNow);
                lucide.createIcons();
            }

            setSpeakingState(isSpeaking) {
                this.isSpeakingNow = isSpeaking;
                this.updateVoiceOverlayUI();

                if (this.voiceOverlayOpen && !this.isListening) {
                    if (isSpeaking) this.setVoiceOverlayState('PulseNova is speaking', 'Voice response is playing. Start talking to interrupt.', false);
                    else this.setVoiceOverlayState('Voice mode', 'Tap Start Listening to speak.', false);
                }
            }

            updateSpeechToggleUI() {
                const btn = document.getElementById('btn-speech-toggle');
                if (!btn) return;
                if (this.speakOutput) {
                    btn.classList.add('text-blue-600');
                    btn.classList.remove('text-slate-400');
                    btn.innerHTML = `<i data-lucide="volume-2" class="w-4 h-4"></i>`;
                } else {
                    btn.classList.remove('text-blue-600');
                    btn.classList.add('text-slate-400');
                    btn.innerHTML = `<i data-lucide="volume-x" class="w-4 h-4"></i>`;
                }
                lucide.createIcons();
            }

            toggleSpeechOutput() {
                this.speakOutput = !this.speakOutput;
                if (!this.speakOutput) {
                    window.speechSynthesis.cancel();
                    this.setSpeakingState(false);
                }
                this.updateSpeechToggleUI();
            }

            speak(text) {
                if (!this.speakOutput || !text) return;

                window.speechSynthesis.cancel();
                this.setSpeakingState(true);

                const utter = new SpeechSynthesisUtterance(text.replace(/\*+/g, '').slice(0, 1200));
                utter.rate = 1;
                utter.pitch = 1;
                utter.onend = () => this.setSpeakingState(false);
                utter.onerror = () => this.setSpeakingState(false);
                window.speechSynthesis.speak(utter);
            }

            // =========================
            // HEART RATE MONITOR (PPG)
            // =========================
            async startVitals() {
                this.vitals.video = document.getElementById('vitals-video');
                this.vitals.canvas = document.getElementById('ppg-graph');
                this.vitals.ctx = this.vitals.canvas.getContext('2d');

                this.vitals.canvas.width = this.vitals.canvas.offsetWidth;
                this.vitals.canvas.height = this.vitals.canvas.offsetHeight;

                const statusEl = document.getElementById('vitals-status');

                try {
                    statusEl.innerText = "Requesting camera...";

                    this.vitals.stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment' }
                    });

                    this.vitals.video.srcObject = this.vitals.stream;
                    this.vitals.video.play();

                    const track = this.vitals.stream.getVideoTracks()[0];
                    if (track.getCapabilities && track.getCapabilities().torch) {
                        try {
                            await track.applyConstraints({ advanced: [{ torch: true }] });
                        } catch (e) {
                            console.warn("Torch not available/allowed:", e);
                        }
                    }

                    document.getElementById('btn-start-vitals').classList.add('hidden');
                    document.getElementById('btn-stop-vitals').classList.remove('hidden');

                    this.vitals.isMonitoring = true;
                    this.vitals.redValues = [];
                    this.vitals.bpmHistory = [];
                    this.vitals.lastPeakTime = 0;
                    statusEl.innerText = "Detecting pulse...";
                    statusEl.classList.add('text-red-400', 'animate-pulse');

                    this.processVitalsFrame();

                } catch (err) {
                    console.error(err);
                    statusEl.innerText = "Camera access denied or unavailable.";
                    alert("Unable to access the camera. Please allow permissions and try again.");
                }
            }

            stopVitals() {
                this.vitals.isMonitoring = false;
                if (this.vitals.animId) cancelAnimationFrame(this.vitals.animId);

                if (this.vitals.stream) {
                    this.vitals.stream.getTracks().forEach(track => track.stop());
                }

                document.getElementById('btn-stop-vitals').classList.add('hidden');
                document.getElementById('btn-start-vitals').classList.remove('hidden');

                const statusEl = document.getElementById('vitals-status');
                statusEl.innerText = "Stopped";
                statusEl.classList.remove('text-red-400', 'animate-pulse');
                document.getElementById('bpm-display').innerText = "--";

                if (this.vitals.ctx && this.vitals.canvas) {
                    this.vitals.ctx.clearRect(0, 0, this.vitals.canvas.width, this.vitals.canvas.height);
                }
            }

            processVitalsFrame() {
                if (!this.vitals.isMonitoring) return;

                const now = performance.now();
                this.vitals.processCtx.drawImage(this.vitals.video, 0, 0, 10, 10);
                const imageData = this.vitals.processCtx.getImageData(0, 0, 10, 10).data;

                let redSum = 0;
                for (let i = 0; i < imageData.length; i += 4) redSum += imageData[i];
                const avgRed = redSum / (imageData.length / 4);

                this.vitals.redValues.push({ time: now, val: avgRed });
                if (this.vitals.redValues.length > 180) this.vitals.redValues.shift();

                this.detectHeartbeat(now);
                this.drawPPGGraph();

                this.vitals.animId = requestAnimationFrame(this.processVitalsFrame);
            }

            detectHeartbeat(now) {
                const data = this.vitals.redValues;
                if (data.length < 30) return;

                let sum = 0;
                for (let d of data) sum += d.val;
                const avg = sum / data.length;

                const current = data[data.length - 1];
                const prev = data[data.length - 2];
                const prev2 = data[data.length - 3];

                if (prev.val > current.val && prev.val > prev2.val && prev.val > avg + 1.5) {
                    if (now - this.vitals.lastPeakTime > 300) {
                        const timeDiff = now - this.vitals.lastPeakTime;
                        if (this.vitals.lastPeakTime > 0) {
                            const instantBPM = 60000 / timeDiff;
                            if (instantBPM > 40 && instantBPM < 200) {
                                this.vitals.bpmHistory.push(instantBPM);
                                if (this.vitals.bpmHistory.length > 5) this.vitals.bpmHistory.shift();
                                const avgBPM = this.vitals.bpmHistory.reduce((a, b) => a + b, 0) / this.vitals.bpmHistory.length;
                                document.getElementById('bpm-display').innerText = Math.round(avgBPM);
                            }
                        }
                        this.vitals.lastPeakTime = now;
                    }
                }
            }

            drawPPGGraph() {
                const ctx = this.vitals.ctx;
                const w = this.vitals.canvas.width;
                const h = this.vitals.canvas.height;
                const data = this.vitals.redValues;

                ctx.clearRect(0, 0, w, h);
                if (data.length < 2) return;

                let min = Infinity, max = -Infinity;
                for (let d of data) {
                    if (d.val < min) min = d.val;
                    if (d.val > max) max = d.val;
                }

                const range = max - min || 1;
                ctx.beginPath();
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.lineJoin = 'round';

                for (let i = 0; i < data.length; i++) {
                    const x = (i / (data.length - 1)) * w;
                    const normalizedY = (data[i].val - min) / range;
                    const y = h - (normalizedY * (h * 0.8)) - (h * 0.1);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // =========================
            // X-RAY / LABS + DRAG DROP
            // =========================
            initDropzones() {
                this.setupDropzone('xray-dropzone', 'xray-input', (file) => this.handleDroppedFile(file, 'xray'));
                this.setupDropzone('lab-dropzone', 'lab-input', (file) => this.handleDroppedFile(file, 'lab'));
            }

            setupDropzone(dropId, inputId, onFile) {
                const zone = document.getElementById(dropId);
                const input = document.getElementById(inputId);
                if (!zone || !input) return;

                ['dragenter', 'dragover'].forEach(evt => {
                    zone.addEventListener(evt, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        zone.classList.add(dropId === 'lab-dropzone' ? 'drop-active-purple' : 'drop-active');
                    });
                });

                ['dragleave', 'drop'].forEach(evt => {
                    zone.addEventListener(evt, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        zone.classList.remove('drop-active', 'drop-active-purple');
                    });
                });

                zone.addEventListener('drop', (e) => {
                    const file = e.dataTransfer?.files?.[0];
                    if (file) onFile(file);
                });
            }

            handleDroppedFile(file, type) {
                const fakeInput = { files: [file] };
                if (type === 'xray') this.handleXrayUpload(fakeInput);
                else this.handleLabUpload(fakeInput);
            }

            handleXrayUpload(input) { this.handleFileUpload(input, 'xray'); }
            handleLabUpload(input) { this.handleFileUpload(input, 'lab'); }

            handleFileUpload(input, type) {
                const file = input.files[0];
                if (!file) return;
                if (!file.type.startsWith('image/')) {
                    alert("Please upload an image file.");
                    return;
                }

                const reader = new FileReader();
                reader.onloadend = () => {
                    const fullData = reader.result;
                    const base64 = fullData.split(',')[1];

                    if (type === 'xray') {
                        this.xrayImage = base64;
                        const img = document.getElementById('xray-preview-img');
                        img.src = fullData;
                        img.classList.remove('hidden');
                        document.getElementById('xray-placeholder').classList.add('hidden');
                        document.getElementById('btn-analyze-xray').disabled = false;
                        document.getElementById('xray-dropzone').classList.add('border-blue-300', 'bg-slate-900');
                    } else {
                        this.labImage = base64;
                        const img = document.getElementById('lab-preview-img');
                        img.src = fullData;
                        img.classList.remove('hidden');
                        document.getElementById('lab-placeholder').classList.add('hidden');
                        document.getElementById('btn-analyze-lab').disabled = false;
                        document.getElementById('lab-dropzone').classList.add('border-purple-300', 'bg-slate-900');
                    }
                };
                reader.readAsDataURL(file);
            }

            async analyzeXray() {
                if (!this.xrayImage) return;
                const btn = document.getElementById('btn-analyze-xray');
                btn.disabled = true;
                btn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Running...`;

                const prompt =
`Analyze this X-Ray/MRI image carefully.
Output format:
###  Summary
[1-2 sentences]
###  Findings
- **Anatomy:** ...
- **Observations:** ...
###  Next Steps
[Practical next steps]
***
*DISCLAIMER: Not a diagnosis.*`;

                const text = await this.callNovaVision(this.xrayImage, prompt);
                document.getElementById('xray-result').innerHTML = this.formatMarkdown(text);

                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="activity" class="w-5 h-5"></i> Analyze Scan`;
                lucide.createIcons();
            }

            async analyzeLabs() {
                if (!this.labImage) return;
                const btn = document.getElementById('btn-analyze-lab');
                btn.disabled = true;
                btn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Translating...`;

                const prompt =
`Analyze this medical lab report image.
Output format:
###  Summary
[1-2 sentences]
###  Key Findings
- **[Test Name]:** [Value]  [Plain English meaning]
###  Flags
[Anything out of range, if visible]
###  Next Steps
[Practical next steps]
***
*DISCLAIMER: Not a diagnosis.*`;

                const text = await this.callNovaVision(this.labImage, prompt);
                document.getElementById('lab-result').innerHTML = this.formatMarkdown(text);

                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="activity" class="w-5 h-5"></i> Translate Report`;
                lucide.createIcons();
            }

            // =========================
            // CARE FINDER UI RENDER
            // =========================
            getFilteredProviders() {
                const typeFilter = document.getElementById('care-filter')?.value || 'All';
                const textFilter = (document.getElementById('provider-filter')?.value || '').trim().toLowerCase();

                let filtered = this.providers.slice();

                if (typeFilter !== 'All') {
                    filtered = filtered.filter(p => p.type === typeFilter);
                }

                if (textFilter) {
                    filtered = filtered.filter(p =>
                        (p.name || '').toLowerCase().includes(textFilter) ||
                        (p.address || '').toLowerCase().includes(textFilter)
                    );
                }

                return filtered;
            }

            renderProviders() {
                const list = document.getElementById('providers-list');
                if (!list) return;
                list.innerHTML = '';

                const filtered = this.getFilteredProviders();

                if (!filtered.length) {
                    list.innerHTML = `
                        <div class="col-span-full bg-white border border-slate-200 rounded-2xl p-6 text-center text-slate-500">
                            No visible providers. Use <strong>Near Me</strong> or search a city/ZIP.
                            <div class="text-xs text-slate-400 mt-2">If you already searched, clear the results filter box.</div>
                        </div>`;
                    return;
                }

                filtered.forEach(p => {
                    const colorClass =
                        p.type === 'ER' ? 'bg-red-100 text-red-700' :
                        p.type === 'Urgent Care' ? 'bg-blue-100 text-blue-700' :
                        p.type === 'Hospital' ? 'bg-orange-100 text-orange-700' :
                        p.type === 'Pharmacy' ? 'bg-green-100 text-green-700' :
                        p.type === 'Dentist' ? 'bg-purple-100 text-purple-700' :
                        p.type === 'Primary Care' ? 'bg-cyan-100 text-cyan-700' :
                        p.type === 'Pediatrician' ? 'bg-pink-100 text-pink-700' :
                        'bg-slate-100 text-slate-700';

                    const ratingText = p.rating ? `${p.rating}` : 'N/A';
                    const distanceText = (typeof p.distance === 'number') ? p.distance.toFixed(1) : '--';

                    const directionsUrl = (p.lat != null && p.lon != null)
                        ? `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(p.lat + ',' + p.lon)}`
                        : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.name + ' ' + p.address)}`;

                    list.innerHTML += `
                        <div class="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow flex justify-between items-start gap-3">
                            <div class="min-w-0">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <span class="text-xs font-bold px-2 py-1 rounded-md ${colorClass}">${this.escapeHtml(p.type)}</span>
                                    <span class="text-xs text-slate-400 flex items-center gap-0.5"><span class="text-yellow-400"></span> ${this.escapeHtml(ratingText)}</span>
                                </div>
                                <h3 class="font-bold text-slate-800 text-lg leading-tight">${this.escapeHtml(p.name)}</h3>
                                <p class="text-slate-500 text-sm mb-3">${this.escapeHtml(p.address)}</p>
                                <div class="flex gap-2 flex-wrap">
                                    <a href="${directionsUrl}" target="_blank" rel="noopener noreferrer"
                                       class="text-xs bg-slate-50 text-slate-600 px-3 py-1.5 rounded-lg border border-slate-200 font-medium hover:bg-slate-100 flex items-center gap-1">
                                        <i data-lucide="map" class="w-3 h-3"></i> Open Map
                                    </a>
                                    <a href="${directionsUrl}" target="_blank" rel="noopener noreferrer"
                                       class="text-xs bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg border border-blue-100 font-medium hover:bg-blue-100 flex items-center gap-1">
                                        <i data-lucide="navigation" class="w-3 h-3"></i> Directions
                                    </a>
                                </div>
                            </div>
                            <div class="text-right shrink-0">
                                <span class="block text-xl font-bold text-slate-900">${this.escapeHtml(distanceText)}</span>
                                <span class="text-xs text-slate-400">miles</span>
                            </div>
                        </div>
                    `;
                });

                lucide.createIcons();
            }

            // =========================
            // UTILS
            // =========================
            escapeHtml(str) {
                return String(str ?? '')
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }

            formatText(text) {
                return this.escapeHtml(text || '').replace(/\n/g, '<br>');
            }

            formatMarkdown(text) {
                const safe = this.escapeHtml(text || '');
                let html = safe
                    .replace(/^### (.*)$/gm, '<h3 class="text-lg font-bold text-blue-800 mt-4 mb-2">$1</h3>')
                    .replace(/\*\*(.*?)\*\*/g, '<span class="font-semibold text-slate-900">$1</span>')
                    .replace(/^\- (.*)$/gm, '<li class="ml-4 list-disc mb-1">$1</li>')
                    .replace(/\*DISCLAIMER:(.*)\*/g, '<p class="text-xs text-slate-500 italic mt-4 border-t pt-2">$1</p>')
                    .replace(/\n/g, '<br>');

                if (html.includes('<li')) {
                    html = html.replace(/(<li[\s\S]*?<\/li>)/g, '<ul>$1</ul>').replace(/<\/ul><br><ul>/g, '');
                }
                return html;
            }
        }

        const app = new PulseNovaApp();
        lucide.createIcons();
    </script>
</body>
</html>
